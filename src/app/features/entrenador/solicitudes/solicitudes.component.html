<div class="solicitudes-container">
  <div class="header-section">
    <h2>Solicitudes de Entrenamiento</h2>
    <button class="btn-primary" (click)="abrirModalNuevo()" [disabled]="loading">
      + Nueva Solicitud
    </button>
  </div>

  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
    <button class="btn-close" (click)="error = null">Ã—</button>
  </div>

  <div *ngIf="loading" class="loading-spinner">
    <div class="spinner"></div>
    Cargando...
  </div>

  <div *ngIf="!loading && solicitudes.length === 0" class="empty-state">
    <p>No hay solicitudes de entrenamiento registradas</p>
  </div>

  <div *ngIf="!loading && solicitudes.length > 0" class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Cliente</th>
          <th>Entrenador</th>
          <th>Inicio</th>
          <th>Fin</th>
          <th>Estado</th>
          <th>Creado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let solicitud of solicitudes">
          <td>{{ solicitud.idSolicitud }}</td>
          <td>{{ solicitud.idCliente }}</td>
          <td>{{ solicitud.idEntrenador || 'No asignado' }}</td>
          <td>{{ solicitud.inicio | date: 'short' }}</td>
          <td>{{ solicitud.fin | date: 'short' }}</td>
          <td>
            <span [ngClass]="'badge ' + getEstadoBadgeClass(solicitud.estado)">
              {{ solicitud.estado }}
            </span>
          </td>
          <td>{{ solicitud.creadoEn | date: 'short' }}</td>
          <td class="acciones">
            <button class="btn-edit" (click)="abrirModalEditar(solicitud)" title="Editar">
              âœŽ
            </button>
            <button class="btn-delete" (click)="eliminar(solicitud.idSolicitud)" title="Eliminar">
              ðŸ—‘
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="modal-overlay" (click)="cerrarModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ isEditMode ? 'Editar' : 'Nueva' }} Solicitud de Entrenamiento</h3>
        <button class="btn-close" (click)="cerrarModal()">Ã—</button>
      </div>

      <div class="modal-body">
        <form (ngSubmit)="guardar()">
          <div class="form-group">
            <label for="idCliente">Cliente *</label>
            <input
              type="number"
              id="idCliente"
              [(ngModel)]="form.idCliente"
              name="idCliente"
              class="form-control"
              required
            />
          </div>

          <div class="form-group">
            <label for="idEntrenador">Entrenador</label>
            <input
              type="number"
              id="idEntrenador"
              [(ngModel)]="form.idEntrenador"
              name="idEntrenador"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label for="inicio">Fecha y Hora Inicio *</label>
            <input
              type="datetime-local"
              id="inicio"
              [(ngModel)]="form.inicio"
              name="inicio"
              class="form-control"
              placeholder="YYYY-MM-DDTHH:mm"
              required
            />
          </div>

          <div class="form-group">
            <label for="fin">Fecha y Hora Fin *</label>
            <input
              type="datetime-local"
              id="fin"
              [(ngModel)]="form.fin"
              name="fin"
              class="form-control"
              placeholder="YYYY-MM-DDTHH:mm"
              required
            />
          </div>

          <div class="form-group">
            <label for="estado">Estado *</label>
            <select
              id="estado"
              [(ngModel)]="form.estado"
              name="estado"
              class="form-control"
              required
            >
              <option value="">Seleccionar estado</option>
              <option *ngFor="let est of estados" value="{{ est }}">{{ est }}</option>
            </select>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn-secondary" (click)="cerrarModal()">
              Cancelar
            </button>
            <button type="submit" class="btn-primary" [disabled]="loading">
              {{ loading ? 'Guardando...' : 'Guardar' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>